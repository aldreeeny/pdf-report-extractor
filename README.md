# PDF Report Data Extractor

This Google Apps Script project provides automated data extraction functionality from PDF reports generated by retail stores. It uses OCR (Optical Character Recognition) to extract financial data and consolidates it into organized Google Sheets for analysis and reporting.

## Overview

The system is designed to process PDF reports from multiple retail store locations (IGA stores and Thirsty Camel), extract key financial metrics, and organize the data into structured spreadsheets. It handles both financial summary data and gross profit data, with integration to wage data from separate sources.

## Features

- **OCR PDF Processing**: Uses Google Drive OCR to extract text from PDF reports
- **Multi-Store Support**: Processes data from multiple retail locations
- **Financial Data Extraction**: Extracts customer counts, refunds, sales totals, and profits
- **Product Category Analysis**: Separates sales by product categories (Beer, Wine, Spirits, Cigarettes)
- **Google Sheets Integration**: Writes extracted data to organized spreadsheets
- **Custom Menu Interface**: Provides easy-to-use menu for updating different stores
- **Wage Data Integration**: Combines financial data with wage information
- **Date-Based Processing**: Matches data by date for accurate record keeping

## File Structure

- `appsscript.json` - Google Apps Script configuration with Drive API
- `Constants.js` - Configuration constants (folder IDs, spreadsheet IDs)
- `Code.js` - Main data extraction and processing functions
- `Menu.js` - Custom menu creation for store selection
- `Tables.js` - Table refresh functions (currently commented out)
- `UpdateTables.js` - Store-specific update functions
- `Util.js` - Utility functions for date processing and data import
- `.clasp.json` - Google Apps Script CLI configuration

## Main Functions

### Data Extraction
- `refreshSheet1Data()` - Extracts financial summary data (customer counts, refunds, net cash)
- `refreshSheet2Data()` - Extracts gross profit data (sales totals, profits, product categories)
- `getTextFromPDF()` - Converts PDF to text using OCR and extracts content

### Store Management
- `updateIgaLaverton()` - Updates IGA Laverton store data
- `updateIgaSpotswood()` - Updates IGA Spotswood store data
- `updateIgaClarendon()` - Updates IGA Clarendon store data
- `updateIgaBittern()` - Updates IGA Bittern store data
- `updateThirstyCamel()` - Updates Thirsty Camel Southbank store data

### Utility Functions
- `getDateFromName()` - Extracts date from PDF filename
- `importToSpreadsheet()` - Writes data to Google Sheets with sorting
- `getWageData()` - Integrates wage data from separate spreadsheets
- `isSameDate()` - Compares dates for matching records

## Setup Instructions

1. **Deploy as Script**:
   - Open the script in Google Apps Script
   - Enable the Drive API advanced service
   - Set up the script in the target Google Spreadsheet

2. **Configure Constants**:
   - Update `Constants.js` with your folder and spreadsheet IDs
   - Set up the correct sheet names for data output

3. **Set Up Google Sheets**:
   - Create a Google Spreadsheet with the following sheets for each store:
     - [Store Name] FS Data (Financial Summary)
     - [Store Name] GP Data (Gross Profit)
     - [Store Name] All Data (Combined data)
     - [Store Name] Links (Folder IDs)

4. **PDF Organization**:
   - Organize PDF reports in Google Drive folders
   - Ensure PDF filenames contain dates in DDMMYYYY format
   - Set up folder IDs in the Links sheets

## Usage

### Custom Menu
The script creates a custom menu "Update Tables" with options for each store:
- IGA LAVERTON
- IGA SPOTSWOOD
- IGA CLARENDON
- IGA BITTERN
- Thirsty Camel Southbank

### Data Processing
1. **Select Store**: Choose the store from the custom menu
2. **PDF Processing**: System processes all PDFs in the store's folder
3. **Data Extraction**: Extracts financial and sales data
4. **Sheet Update**: Writes organized data to appropriate sheets
5. **Wage Integration**: Combines with wage data from separate sources

## Data Types Extracted

### Financial Summary Data (Sheet 1)
- Date
- Customer Count
- Refunds
- Net Cash Totals

### Gross Profit Data (Sheet 2)
- Date
- Total Sales
- Total Profit
- Product Category Sales:
  - Beer
  - Wine
  - Spirits
  - Cigarettes & Tobacco
- Combined BWST (Beer + Wine + Spirits + Tobacco)

### Combined Data
- All financial summary data
- All gross profit data
- Wage data (from separate spreadsheets)

## PDF Requirements

PDF files should:
- Be named with date format: DDMMYYYY.pdf
- Contain structured text data
- Include specific keywords for data extraction:
  - "Customers Item Count"
  - "Paid Out Cash Out Returns"
  - "Net Tender Totals"
  - "Totals"
  - "BEER", "WINE", "SPIRITS", "CIGS & TABACCO"

## Dependencies

- Google Apps Script
- Google Drive API (Advanced Service)
- Google Sheets API
- OCR functionality for PDF processing

## Security Notes

- Folder IDs and spreadsheet IDs should be stored securely
- Consider using Google Apps Script's Properties Service for sensitive data
- Ensure proper access controls for Google Drive folders and sheets

## Error Handling

The system includes error handling to:
- Handle missing PDF files gracefully
- Continue processing even if individual files fail
- Log processing steps for debugging
- Match data by date for accurate record keeping

## Monitoring

Monitor the execution through:
- Google Apps Script execution logs
- Google Sheets data updates
- Custom menu functionality

## Customization

To customize the system:
- Add new store locations
- Modify data extraction patterns
- Change sheet names and structures
- Adjust date parsing logic
- Add new data fields to extract

## Data Processing Flow

1. **PDF Discovery**: Scan Google Drive folder for PDF files
2. **OCR Processing**: Convert PDF to text using Google Drive OCR
3. **Text Parsing**: Extract data using pattern matching
4. **Date Matching**: Match extracted data with existing records
5. **Data Consolidation**: Combine financial and wage data
6. **Sheet Update**: Write organized data to Google Sheets
7. **Sorting**: Sort data by date for easy analysis

## Performance Considerations

- OCR processing can be time-intensive for large PDFs
- Consider processing PDFs in batches
- Monitor Google Apps Script execution time limits
- Use appropriate sleep intervals between operations 